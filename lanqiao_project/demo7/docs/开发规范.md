# å¼€å‘è§„èŒƒæ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [ç¼–ç è§„èŒƒ](#ç¼–ç è§„èŒƒ)
- [æ³¨é‡Šè§„èŒƒ](#æ³¨é‡Šè§„èŒƒ)
- [æ–‡ä»¶ç»„ç»‡](#æ–‡ä»¶ç»„ç»‡)
- [å‘½åè§„èŒƒ](#å‘½åè§„èŒƒ)
- [Git æäº¤è§„èŒƒ](#git-æäº¤è§„èŒƒ)

---

## ç¼–ç è§„èŒƒ

### 1. ä»£ç é£æ ¼

#### ç¼©è¿›ä¸ç©ºæ ¼

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Tab ç¼©è¿›ï¼ˆä¸é¡¹ç›®ç°æœ‰ä»£ç ä¸€è‡´ï¼‰
void Function(void)
{
	unsigned char i;
	for(i = 0; i < 8; i++)
	{
		// ä»£ç ...
	}
}

// âŒ é”™è¯¯ï¼šæ··ç”¨ç©ºæ ¼å’Œ Tab
void Function(void)
{
    unsigned char i;  // 4ä¸ªç©ºæ ¼
	for(i = 0; i < 8; i++)  // Tab
	{
	    // æ··ä¹±çš„ç¼©è¿›
	}
}
```

#### å¤§æ‹¬å·ä½ç½®

```c
// âœ… æ­£ç¡®ï¼šK&R é£æ ¼ï¼ˆä¸é¡¹ç›®ä¸€è‡´ï¼‰
void Function(void) {
	if(condition) {
		// ä»£ç ...
	} else {
		// ä»£ç ...
	}
}

// âš ï¸ å¤‡é€‰ï¼šAllman é£æ ¼ï¼ˆå¯é€‰ï¼Œä½†éœ€ç»Ÿä¸€ï¼‰
void Function(void)
{
	if(condition)
	{
		// ä»£ç ...
	}
	else
	{
		// ä»£ç ...
	}
}
```

#### ç©ºæ ¼ä½¿ç”¨

```c
// âœ… æ­£ç¡®
if(condition)           // æ¡ä»¶è¯­å¥æ— ç©ºæ ¼
for(i = 0; i < 8; i++)  // å¾ªç¯è¯­å¥æ— ç©ºæ ¼
x = a + b;              // è¿ç®—ç¬¦ä¸¤ä¾§æœ‰ç©ºæ ¼

// âŒ é”™è¯¯
if (condition)          // ä¸ç¬¦åˆé¡¹ç›®é£æ ¼
x=a+b;                  // å¯è¯»æ€§å·®
```

---

### 2. å˜é‡å®šä¹‰

#### ç±»å‹é€‰æ‹©

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ˜ç¡®çš„ç±»å‹
unsigned char count;      // 0-255 çš„è®¡æ•°
unsigned int voltage;     // 0-65535 çš„ç”µå‹å€¼
bit flag;                 // å¸ƒå°”æ ‡å¿—ä½

// âŒ é”™è¯¯ï¼šç±»å‹ä¸æ˜ç¡®
unsigned i;               // åº”ä¸º unsigned char
int data;                 // æœ‰ç¬¦å·ç±»å‹ï¼ˆé™¤ééœ€è¦è´Ÿæ•°ï¼‰
```

#### åˆå§‹åŒ–

```c
// âœ… æ­£ç¡®ï¼šå®šä¹‰æ—¶åˆå§‹åŒ–
unsigned char count = 0;
unsigned int voltage = 200;

// âš ï¸ æ³¨æ„ï¼šé™æ€å˜é‡è‡ªåŠ¨åˆå§‹åŒ–ä¸º 0
static unsigned char temp = 0;  // å¯çœç•¥ = 0

// âŒ é”™è¯¯ï¼šæœªåˆå§‹åŒ–å°±ä½¿ç”¨
unsigned char value;
if(value > 10) {  // æœªå®šä¹‰è¡Œä¸º
	// ...
}
```

#### æ•°ç»„å®šä¹‰

```c
// âœ… æ­£ç¡®ï¼šæ˜ç¡®æŒ‡å®šå¤§å°å’Œåˆå§‹å€¼
unsigned char Seg_Buf[8] = {10, 10, 10, 10, 10, 10, 10, 10};
unsigned char ucLed[8] = {0, 0, 0, 0, 0, 0, 0, 0};

// âš ï¸ ç®€åŒ–å†™æ³•
unsigned char Seg_Buf[8] = {10};  // ä»…é¦–å…ƒç´ ä¸º10ï¼Œå…¶ä½™ä¸º0

// âŒ é”™è¯¯ï¼šæœªæŒ‡å®šå¤§å°
unsigned char data[] = {1, 2, 3};  // åº”æ˜ç¡®å†™ [3]
```

---

### 3. å‡½æ•°è®¾è®¡

#### å‡½æ•°é•¿åº¦

```c
// âœ… æ­£ç¡®ï¼šå•ä¸€èŒè´£ï¼Œå‡½æ•°ç®€çŸ­
void Key_Proc(void)
{
	// ä»…å¤„ç†æŒ‰é”®æ‰«æå’Œäº‹ä»¶åˆ†å‘
	// çº¦ 30 è¡Œä»£ç 
}

// âŒ é”™è¯¯ï¼šå‡½æ•°è¿‡é•¿ï¼ŒèŒè´£æ··ä¹±
void Seg_Proc(void)
{
	// AD é‡‡é›†
	// DA è¾“å‡º
	// ä¸šåŠ¡é€»è¾‘
	// æ•°ç ç®¡æ˜¾ç¤º
	// è¶…è¿‡ 100 è¡Œä»£ç 
}
```

**åŸåˆ™ï¼š**
- å•ä¸ªå‡½æ•°ä¸è¶…è¿‡ 50 è¡Œ
- è¶…è¿‡ 80 è¡Œå¿…é¡»æ‹†åˆ†

#### å‚æ•°ä¼ é€’

```c
// âœ… æ­£ç¡®ï¼šå‚æ•°ç±»å‹æ˜ç¡®
void Seg_Disp(unsigned char wela, unsigned char dula, unsigned char point);

// âŒ é”™è¯¯ï¼šå‚æ•°ç±»å‹ä¸æ˜ç¡®
void Seg_Disp(unsigned char wela, dula, point);  // dula å’Œ point ç±»å‹æœªå£°æ˜
```

#### è¿”å›å€¼

```c
// âœ… æ­£ç¡®ï¼šæœ‰æ˜ç¡®è¿”å›å€¼
unsigned char Key_Read(void)
{
	// ...
	return temp;  // æ€»æ˜¯è¿”å›
}

// âŒ é”™è¯¯ï¼šéƒ¨åˆ†åˆ†æ”¯æ— è¿”å›å€¼
unsigned char GetValue(void)
{
	if(condition) {
		return 1;
	}
	// ç¼ºå°‘ else åˆ†æ”¯çš„è¿”å›
}
```

---

### 4. å¸¸é‡å®šä¹‰

#### ä½¿ç”¨ #define

```c
// âœ… æ­£ç¡®ï¼šå®šä¹‰å¸¸é‡
#define LED_CTRL_ADDR      0x80
#define BEEP_RELAY_ADDR    0xA0
#define SEG_WELA_ADDR      0xC0
#define SEG_DULA_ADDR      0xE0

#define PCF8591_ADDR_W     0x90
#define PCF8591_ADDR_R     0x91
#define ADC_CHANNEL_AIN3   0x43
#define DAC_CHANNEL        0x41

#define VOLTAGE_SCALE      100
#define ADC_DA_FACTOR      51

// âŒ é”™è¯¯ï¼šé­”æ³•æ•°å­—
P2 = P2 & 0x1f | 0x80;  // 0x80 æ˜¯ä»€ä¹ˆï¼Ÿ
dat = (Ad_Read(0x43) * 100) / 51;  // 100 å’Œ 51 æ˜¯ä»€ä¹ˆï¼Ÿ
```

#### æšä¸¾ç±»å‹

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æšä¸¾ç®¡ç†çŠ¶æ€
typedef enum {
	DISPLAY_VOLTAGE_IN,   // 0
	DISPLAY_VOLTAGE_OUT   // 1
} DisplayMode_t;

// ä½¿ç”¨
DisplayMode_t mode = DISPLAY_VOLTAGE_IN;

// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨æ•°å­—
unsigned char mode = 0;  // 0 ä»£è¡¨ä»€ä¹ˆï¼Ÿ
```

---

### 5. ä½æ“ä½œ

#### æ¸…æ™°çš„ä½æ“ä½œ

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä½æ©ç å¸¸é‡
#define BEEP_BIT  0x40  // Bit6
#define RELAY_BIT 0x10  // Bit4

void Beep(unsigned char flag)
{
	if(flag)
		temp |= BEEP_BIT;   // ç½®ä½
	else
		temp &= ~BEEP_BIT;  // æ¸…é›¶
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä½åç§»
#define LED_BIT(n)  (1 << (n))

void Led_On(unsigned char led_num)
{
	temp |= LED_BIT(led_num);
}

// âŒ é”™è¯¯ï¼šé­”æ³•æ•°å­—
temp |= 0x40;  // ä»€ä¹ˆä½ï¼Ÿ
temp &= ~0x10; // ä»€ä¹ˆä½ï¼Ÿ
```

---

## æ³¨é‡Šè§„èŒƒ

### 1. æ–‡ä»¶å¤´æ³¨é‡Š

```c
/**
 * @file    iic.c
 * @brief   PCF8591 I2C é©±åŠ¨
 * @author  [ä½œè€…å§“å]
 * @date    2026-02-04
 * @version v1.0
 *
 * @details
 * å®ç° I2C æ€»çº¿åº•å±‚é©±åŠ¨å’Œ PCF8591 AD/DA èŠ¯ç‰‡æ¥å£
 * - I2C åŸºæœ¬æ—¶åºï¼ˆSTART/STOP/ACK/NACKï¼‰
 * - AD é‡‡é›†æ¥å£
 * - DA è¾“å‡ºæ¥å£
 */
```

### 2. å‡½æ•°æ³¨é‡Š

```c
/**
 * @brief  è¯»å– PCF8591 æŒ‡å®šé€šé“çš„ AD å€¼
 * @param  addr: ADC é€šé“åœ°å€ï¼ˆ0x40-0x43ï¼‰
 *         - 0x40: AIN0
 *         - 0x41: AIN1
 *         - 0x42: AIN2
 *         - 0x43: AIN3
 * @retval 8 ä½ AD å€¼ï¼ˆ0-255ï¼‰
 * @note   éœ€å…ˆè°ƒç”¨ IIC_Start()
 */
unsigned char Ad_Read(unsigned char addr)
{
	// å®ç°...
}
```

### 3. ä»£ç å—æ³¨é‡Š

```c
// âœ… æ­£ç¡®ï¼šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œé"æ˜¯ä»€ä¹ˆ"
// ä½¿ç”¨é™æ€å˜é‡ç¼“å­˜çŠ¶æ€ï¼Œé¿å…é‡å¤åˆ·æ–°ç¡¬ä»¶
static unsigned char temp_old = 0xff;
if(temp != temp_old) {
	// ä»…åœ¨çŠ¶æ€æ”¹å˜æ—¶å†™å…¥ç¡¬ä»¶
	P0 = ~temp;
}

// âŒ é”™è¯¯ï¼šæ³¨é‡Šé‡å¤ä»£ç 
// å¦‚æœ temp ä¸ç­‰äº temp_old
if(temp != temp_old) {
	// å°† temp å–ååèµ‹å€¼ç»™ P0
	P0 = ~temp;
}
```

### 4. å…³é”®é€»è¾‘æ³¨é‡Š

```c
// âœ… æ­£ç¡®ï¼šè§£é‡Šå¤æ‚çš„è®¡ç®—å…¬å¼
// ç”µå‹æ¢ç®—å…¬å¼ï¼š
// PCF8591 åˆ†è¾¨ç‡ = 5V / 255 = 0.0196V
// ç›®æ ‡åˆ†è¾¨ç‡ = 0.01V
// æ¢ç®—ç³»æ•° = 255 / 500 = 51 / 100
dat = (Ad_Read(ADC_CHANNEL_AIN3) * VOLTAGE_SCALE) / ADC_DA_FACTOR;

// âŒ é”™è¯¯ï¼šæ— æ³¨é‡Šçš„é­”æ³•å…¬å¼
dat = (Ad_Read(0x43) * 100) / 51;
```

### 5. TODO æ³¨é‡Š

```c
// TODO: æ·»åŠ  AD é‡‡æ ·æ»¤æ³¢ç®—æ³•
// FIXME: æŒ‰é”®æ¶ˆæŠ–ç®—æ³•éœ€è¦ä¼˜åŒ–
// HACK: ä¸´æ—¶æ–¹æ¡ˆï¼Œåç»­éœ€é‡æ„
// NOTE: æ­¤å¤„å»¶æ—¶ç²¾ç¡®åº¦è¦æ±‚è¾ƒé«˜
```

---

## æ–‡ä»¶ç»„ç»‡

### 1. ç›®å½•ç»“æ„

```
demo7/
â”œâ”€â”€ Driver/              # é©±åŠ¨å±‚ï¼ˆä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ Init.c/h        # ç³»ç»Ÿåˆå§‹åŒ–
â”‚   â”œâ”€â”€ Key.c/h         # æŒ‰é”®é©±åŠ¨
â”‚   â”œâ”€â”€ Led.c/h         # LED é©±åŠ¨
â”‚   â”œâ”€â”€ Seg.c/h         # æ•°ç ç®¡é©±åŠ¨
â”‚   â””â”€â”€ iic.c/h         # I2C é©±åŠ¨
â”œâ”€â”€ User/               # ç”¨æˆ·å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â””â”€â”€ main.c          # ä¸»ç¨‹åº
â”œâ”€â”€ docs/               # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ APIå‚è€ƒæ‰‹å†Œ.md
â”‚   â”œâ”€â”€ ç¡¬ä»¶æ¥å£æ–‡æ¡£.md
â”‚   â””â”€â”€ å¼€å‘è§„èŒƒ.md
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

### 2. å¤´æ–‡ä»¶ç»„ç»‡

#### å¤´æ–‡ä»¶ä¿æŠ¤

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ ifndef ä¿æŠ¤
#ifndef _IIC_H
#define _IIC_H

// å£°æ˜...

#endif

// âŒ é”™è¯¯ï¼šæ— å¤´æ–‡ä»¶ä¿æŠ¤
// iic.h
unsigned char Ad_Read(unsigned char addr);
```

#### å¤´æ–‡ä»¶å†…å®¹

```c
// âœ… æ­£ç¡®ï¼šå¤´æ–‡ä»¶ä»…åŒ…å«å£°æ˜
#ifndef _KEY_H
#define _KEY_H

#include <STC15F2K60S2.H>

// å‡½æ•°å£°æ˜
unsigned char Key_Read(void);

#endif

// âŒ é”™è¯¯ï¼šå¤´æ–‡ä»¶åŒ…å«å®ç°
#ifndef _KEY_H
#define _KEY_H

unsigned char Key_Read(void)
{
	// å®ç°ä»£ç ...ï¼ˆåº”æ”¾åœ¨ .c æ–‡ä»¶ï¼‰
}

#endif
```

### 3. åŒ…å«é¡ºåº

```c
// âœ… æ­£ç¡®ï¼šæŒ‰ä¼˜å…ˆçº§åŒ…å«
#include <STC15F2K60S2.H>  // 1. ç³»ç»Ÿå¤´æ–‡ä»¶
#include "intrins.h"        // 2. ç¼–è¯‘å™¨å¤´æ–‡ä»¶
#include "iic.h"            // 3. é¡¹ç›®å¤´æ–‡ä»¶
#include "Init.h"
#include "Key.h"

// âŒ é”™è¯¯ï¼šé¡ºåºæ··ä¹±
#include "Key.h"
#include <STC15F2K60S2.H>
#include "iic.h"
```

---

## å‘½åè§„èŒƒ

### 1. å‡½æ•°å‘½å

```c
// âœ… æ­£ç¡®ï¼šåŠ¨è¯ + åè¯ï¼Œé¦–å­—æ¯å¤§å†™
void System_Init(void);     // ç³»ç»Ÿåˆå§‹åŒ–
unsigned char Key_Read(void);  // è¯»å–æŒ‰é”®
void Led_Disp(unsigned char addr, unsigned char enable);  // LED æ˜¾ç¤º
void Beep(unsigned char flag);  // èœ‚é¸£å™¨

// âŒ é”™è¯¯ï¼šå‘½åä¸æ¸…æ™°
void init(void);       // å¤ªå®½æ³›
void k(void);          // æ— æ„ä¹‰
void do_something(void);  // ä¸æ˜ç¡®
```

### 2. å˜é‡å‘½å

```c
// âœ… æ­£ç¡®ï¼šå°å†™ + ä¸‹åˆ’çº¿ï¼Œæè¿°æ€§å‘½å
unsigned char key_val;        // æŒ‰é”®å€¼
unsigned char seg_pos;        // æ•°ç ç®¡ä½ç½®
unsigned int voltage;         // ç”µå‹å€¼
bit led_display;              // LED æ˜¾ç¤ºæ ‡å¿—

// âŒ é”™è¯¯ï¼šå‘½åä¸è§„èŒƒ
unsigned char kv;       // ç¼©å†™ä¸æ˜ç¡®
unsigned char data;     // å¤ªå®½æ³›
unsigned char temp123;  // æ— æ„ä¹‰æ•°å­—
```

### 3. å…¨å±€å˜é‡å‘½å

```c
// âœ… æ­£ç¡®ï¼šé¦–å­—æ¯å¤§å†™ï¼ŒåŒºåˆ†å±€éƒ¨å˜é‡
unsigned char Key_Val;
unsigned char Seg_Buf[8];
unsigned int Voltage;

// âš ï¸ å¤‡é€‰ï¼šä½¿ç”¨å‰ç¼€
unsigned char g_key_val;
unsigned char g_seg_buf[8];
```

### 4. å¸¸é‡å‘½å

```c
// âœ… æ­£ç¡®ï¼šå…¨å¤§å†™ + ä¸‹åˆ’çº¿
#define LED_CTRL_ADDR      0x80
#define ADC_CHANNEL_AIN3   0x43
#define VOLTAGE_SCALE      100

// âŒ é”™è¯¯ï¼šå‘½åä¸è§„èŒƒ
#define led_addr  0x80     // åº”å…¨å¤§å†™
#define ADCCH     0x43     // ç¼©å†™ä¸æ˜ç¡®
```

### 5. ç±»å‹å®šä¹‰

```c
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ _t åç¼€
typedef enum {
	DISPLAY_VOLTAGE_IN,
	DISPLAY_VOLTAGE_OUT
} DisplayMode_t;

typedef struct {
	unsigned int input;
	unsigned int output;
	bit mode;
} VoltageCtrl_t;

// âŒ é”™è¯¯ï¼šæ— åç¼€
typedef enum {
	MODE1,
	MODE2
} Mode;  // å®¹æ˜“ä¸å˜é‡æ··æ·†
```

---

## Git æäº¤è§„èŒƒ

### 1. æäº¤ä¿¡æ¯æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### 2. Type ç±»å‹

| Type | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| feat | æ–°åŠŸèƒ½ | feat(adc): æ·»åŠ  AD æ»¤æ³¢ç®—æ³• |
| fix | Bug ä¿®å¤ | fix(key): ä¿®å¤æŒ‰é”®è¿å‡»é—®é¢˜ |
| docs | æ–‡æ¡£æ›´æ–° | docs(readme): æ›´æ–° API è¯´æ˜ |
| style | ä»£ç æ ¼å¼ | style: ç»Ÿä¸€ç¼©è¿›ä¸º Tab |
| refactor | é‡æ„ | refactor(seg): æ‹†åˆ†ä¸šåŠ¡é€»è¾‘ |
| perf | æ€§èƒ½ä¼˜åŒ– | perf(led): ä¼˜åŒ–åˆ·æ–°ç­–ç•¥ |
| test | æµ‹è¯•ç›¸å…³ | test: æ·»åŠ å•å…ƒæµ‹è¯• |
| chore | æ„å»º/å·¥å…· | chore: æ›´æ–° Keil é…ç½® |

### 3. æäº¤ç¤ºä¾‹

```bash
# âœ… æ­£ç¡®
git commit -m "feat(adc): æ·»åŠ å¤šæ¬¡é‡‡æ ·å¹³å‡æ»¤æ³¢
- å®ç° 10 æ¬¡é‡‡æ ·æ±‚å¹³å‡
- å‡å°‘ AD å€¼æŠ–åŠ¨
- æé«˜æµ‹é‡ç²¾åº¦"

# âœ… æ­£ç¡®
git commit -m "fix(key): ä¿®å¤ S5 æŒ‰é”®æ— å“åº”
åŸå› ï¼šKey_Down åˆ¤æ–­é€»è¾‘é”™è¯¯
è§£å†³ï¼šä¿®æ”¹è¾¹æ²¿æ£€æµ‹ç®—æ³•"

# âŒ é”™è¯¯
git commit -m "update"  // ä¿¡æ¯ä¸æ˜ç¡®
git commit -m "ä¿®æ”¹ä»£ç "  // æ— å…·ä½“è¯´æ˜
```

### 4. åˆ†æ”¯ç®¡ç†

```bash
# ä¸»åˆ†æ”¯
main / master    # ç¨³å®šç‰ˆæœ¬

# å¼€å‘åˆ†æ”¯
develop          # å¼€å‘ä¸»çº¿
feature/xxx      # æ–°åŠŸèƒ½åˆ†æ”¯
bugfix/xxx       # Bug ä¿®å¤åˆ†æ”¯
hotfix/xxx       # ç´§æ€¥ä¿®å¤åˆ†æ”¯
```

---

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•

### æäº¤å‰æ£€æŸ¥

- [ ] ä»£ç ç¼–è¯‘æ— é”™è¯¯æ— è­¦å‘Š
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ä»£ç æ ¼å¼ç¬¦åˆè§„èŒƒ
- [ ] å˜é‡å‘½åæ¸…æ™°
- [ ] å‡½æ•°èŒè´£å•ä¸€
- [ ] å…³é”®é€»è¾‘æœ‰æ³¨é‡Š
- [ ] æ— é­”æ³•æ•°å­—
- [ ] æ— å†—ä½™ä»£ç 
- [ ] Git æäº¤ä¿¡æ¯è§„èŒƒ

---

## ğŸ“š æ¨èèµ„æº

### ç¼–ç è§„èŒƒå‚è€ƒ

- [C Coding Standard](https://users.ece.cmu.edu/~eno/coding/CCodingStandard.html)
- [MISRA C](https://www.misra.org.uk/)ï¼ˆåµŒå…¥å¼ C è¯­è¨€æ ‡å‡†ï¼‰
- [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html)

### Git è§„èŒƒå‚è€ƒ

- [Conventional Commits](https://www.conventionalcommits.org/)
- [Angular Git Commit Guidelines](https://github.com/angular/angular/blob/master/CONTRIBUTING.md)

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-02-04
