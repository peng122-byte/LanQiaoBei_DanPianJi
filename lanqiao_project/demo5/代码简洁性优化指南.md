# åµŒå…¥å¼Cä»£ç ç®€æ´æ€§ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [å¸ƒå°”è¡¨è¾¾å¼æŠ€å·§](#æŠ€å·§1-å¸ƒå°”è¡¨è¾¾å¼ç®€åŒ–)
2. [ä½è¿ç®—ä¼˜åŒ–](#æŠ€å·§2-ä½è¿ç®—ä¸é€»è¾‘è¿ç®—)
3. [ä¸‰å…ƒè¿ç®—ç¬¦](#æŠ€å·§3-ä¸‰å…ƒè¿ç®—ç¬¦)
4. [æ•°ç»„ç´¢å¼•è®¡ç®—](#æŠ€å·§4-æ•°ç»„ç´¢å¼•è®¡ç®—æŠ€å·§)
5. [å¾ªç¯ä¼˜åŒ–](#æŠ€å·§5-å¾ªç¯ç®€åŒ–)
6. [æ¡ä»¶åˆ¤æ–­ç®€åŒ–](#æŠ€å·§6-æ¡ä»¶åˆ¤æ–­ç®€åŒ–)
7. [æ•°æ®ç»“æ„ä¼˜åŒ–](#æŠ€å·§7-æ•°æ®ç»“æ„ä¼˜åŒ–)
8. [å®å®šä¹‰æŠ€å·§](#æŠ€å·§8-å®å®šä¹‰ä¸å¸¸é‡)
9. [å‡½æ•°å†…è”](#æŠ€å·§9-å‡½æ•°å°è£…ä¸å†…è”)
10. [çŠ¶æ€æœºä¼˜åŒ–](#æŠ€å·§10-çŠ¶æ€æœºä¼˜åŒ–)

---

## æŠ€å·§1: å¸ƒå°”è¡¨è¾¾å¼ç®€åŒ–

### 1.1 åˆ©ç”¨Cè¯­è¨€éšå¼ç±»å‹è½¬æ¢

#### âŒ å†—ä½™å†™æ³•ï¼ˆä½ çš„åŸä»£ç ï¼‰
```c
void Led_Proc()
{
    // LED0ï¼šæ¸©åº¦è¶…è¿‡ä¸Šé™
    if(Temperature_Data > TMAX)
    {
        Led_Level = 3;
        ucLed[0] = 1;
    }
    else
    {
        ucLed[0] = 0;
    }

    // LED1ï¼šæ¸©åº¦åœ¨èŒƒå›´å†…
    if((Temperature_Data >= TMIN) && (Temperature_Data <= TMAX))
    {
        Led_Level = 6;
        ucLed[1] = 1;
    }
    else
    {
        ucLed[1] = 0;
    }

    // LED2ï¼šæ¸©åº¦ä½äºä¸‹é™
    if(Temperature_Data < TMIN)
    {
        Led_Level = 9;
        ucLed[2] = 1;
    }
    else
    {
        ucLed[2] = 0;
    }

    // LED3ï¼šæ•°æ®é”™è¯¯æ ‡å¿—
    if(Data_Error == 1)
    {
        ucLed[3] = 1;
    }
    else
    {
        ucLed[3] = 0;
    }
}
```
**è¡Œæ•°**ï¼š34è¡Œ

---

#### âœ… ç®€æ´å†™æ³•ï¼ˆèŒƒä¾‹ç¨‹åºé£æ ¼ï¼‰
```c
void Led_Proc()
{
    // ç›´æ¥å°†å¸ƒå°”è¡¨è¾¾å¼ç»“æœèµ‹å€¼ç»™å˜é‡
    ucLed[0] = (Temperature_Data > TMAX);
    ucLed[1] = (Temperature_Data >= TMIN) && (Temperature_Data <= TMAX);
    ucLed[2] = (Temperature_Data < TMIN);
    ucLed[3] = Data_Error;

    // PWMç­‰çº§åˆ¤æ–­
    if(Temperature_Data > TMAX)
        Led_Level = 3;
    else if(Temperature_Data >= TMIN)
        Led_Level = 6;
    else
        Led_Level = 9;
}
```
**è¡Œæ•°**ï¼š14è¡Œï¼ˆå‡å°‘59%ï¼‰

---

#### ğŸ” åŸç†è§£æ
```c
// Cè¯­è¨€ä¸­ï¼š
// çœŸå€¼è¡¨è¾¾å¼ = 1
// å‡å€¼è¡¨è¾¾å¼ = 0

unsigned char result;
result = (5 > 3);  // result = 1
result = (5 < 3);  // result = 0

// å› æ­¤å¯ä»¥ç›´æ¥èµ‹å€¼
ucLed[0] = (Temperature_Data > TMAX);
// ç­‰ä»·äº
if(Temperature_Data > TMAX)
    ucLed[0] = 1;
else
    ucLed[0] = 0;
```

---

### 1.2 æè‡´ä¼˜åŒ–ï¼šåˆ©ç”¨æ•´æ•°é™¤æ³•

#### âœ… èŒƒä¾‹ç¨‹åºçš„æŠ€å·§
```c
// åˆ©ç”¨æ•´æ•°é™¤æ³•åˆ¤æ–­å¤§å°å…³ç³»
ucLed[0] = (int)Temperature / Parameter_Ctrol[0];

// åŸç†ï¼š
// è‹¥ Temperature >= Parameter_Ctrol[0]ï¼Œå•†â‰¥1ï¼ˆçœŸï¼‰
// è‹¥ Temperature < Parameter_Ctrol[0]ï¼Œå•†=0ï¼ˆå‡ï¼‰
```

#### ğŸ” çœŸå€¼è¡¨
```
Temperature=35, Parameter_Ctrol[0]=30
35 / 30 = 1ï¼ˆæ•´æ•°é™¤æ³•ï¼‰ â†’ ucLed[0] = 1

Temperature=25, Parameter_Ctrol[0]=30
25 / 30 = 0ï¼ˆæ•´æ•°é™¤æ³•ï¼‰ â†’ ucLed[0] = 0
```

---

#### å¤æ‚æ¡ä»¶ç»„åˆ
```c
// èŒƒä¾‹ç¨‹åºï¼šåˆ¤æ–­æ¸©åº¦åœ¨èŒƒå›´å†…
ucLed[1] = (!((int)Temperature / Parameter_Ctrol[0])) &
           ((int)Temperature / Parameter_Ctrol[1]);

// æ‹†è§£ï¼š
// Part1: !((int)Temperature / Parameter_Ctrol[0])
//        â†’ Temperature < Parameter_Ctrol[0] (ä¸Šé™)
// Part2: ((int)Temperature / Parameter_Ctrol[1])
//        â†’ Temperature >= Parameter_Ctrol[1] (ä¸‹é™)
// ç»“æœ: (Temperature < ä¸Šé™) && (Temperature >= ä¸‹é™)
```

---

### 1.3 å®æˆ˜æ”¹è¿›å»ºè®®

#### æ¨èå†™æ³•ï¼ˆå¹³è¡¡ç®€æ´ä¸å¯è¯»æ€§ï¼‰
```c
void Led_Proc()
{
    // æ–¹æ¡ˆ1ï¼šå¸ƒå°”è¡¨è¾¾å¼ï¼ˆæ¨èï¼‰
    ucLed[0] = (Temperature_Data > TMAX);
    ucLed[1] = (Temperature_Data >= TMIN) && (Temperature_Data <= TMAX);
    ucLed[2] = (Temperature_Data < TMIN);
    ucLed[3] = Data_Error;

    // æ–¹æ¡ˆ2ï¼šæ•´æ•°é™¤æ³•ï¼ˆä»…å½“æ€§èƒ½å…³é”®æ—¶ä½¿ç”¨ï¼‰
    // ucLed[0] = Temperature_Data / (TMAX + 1);  // éœ€è¦TMAX+1é¿å…é™¤0

    // PWMç­‰çº§
    Led_Level = (Temperature_Data > TMAX) ? 3 :
                (Temperature_Data >= TMIN) ? 6 : 9;
}
```

---

## æŠ€å·§2: ä½è¿ç®—ä¸é€»è¾‘è¿ç®—

### 2.1 ä½è¿ç®—ç¬¦ä¼˜åŒ–

#### âŒ æ™®é€šå†™æ³•
```c
// å‚æ•°åˆ‡æ¢
if(Parameter_Index == 0)
    Parameter_Index = 1;
else
    Parameter_Index = 0;
```

#### âœ… ç®€æ´å†™æ³•
```c
// å¼‚æˆ–è¿ç®—ç¿»è½¬
Parameter_Index ^= 1;  // 0â†”1åˆ‡æ¢

// åŸç†ï¼š
// 0 ^ 1 = 1
// 1 ^ 1 = 0
```

---

### 2.2 ä½æ“ä½œé›†åˆ

```c
// 1. ç½®ä½ï¼ˆè®¾ç½®æŸä½ä¸º1ï¼‰
ucLed[i] |= (1 << n);   // å°†ç¬¬nä½ç½®1

// 2. æ¸…ä½ï¼ˆè®¾ç½®æŸä½ä¸º0ï¼‰
ucLed[i] &= ~(1 << n);  // å°†ç¬¬nä½æ¸…0

// 3. ç¿»è½¬
ucLed[i] ^= (1 << n);   // å°†ç¬¬nä½ç¿»è½¬

// 4. æµ‹è¯•ä½
if(ucLed[i] & (1 << n)) // æµ‹è¯•ç¬¬nä½æ˜¯å¦ä¸º1

// 5. å–å
P1 = ~temp;             // æ‰€æœ‰ä½å–åï¼ˆLEDé©±åŠ¨å¸¸ç”¨ï¼‰
```

---

### 2.3 å®æˆ˜æ¡ˆä¾‹ï¼šLEDé©±åŠ¨ä¼˜åŒ–

#### âŒ ä½ çš„åŸä»£ç 
```c
void Led_Disp(unsigned char addr, enable)
{
    static unsigned char temp = 0x00;
    static unsigned char temp_old = 0xff;

    if(enable)
        temp |= 0x01 << addr;   // ç½®ä½
    else
        temp &= ~(0x01 << addr); // æ¸…ä½

    if(temp != temp_old)
    {
        P1 = ~temp;
        temp_old = temp;
    }
}
```
**åˆ†æ**ï¼šè¿™ä¸ªå·²ç»å¾ˆç®€æ´äº†ï¼ä¿æŒå³å¯ã€‚

---

### 2.4 ä½åŸŸï¼ˆBit Fieldï¼‰æŠ€å·§

#### âœ… ä½¿ç”¨ä½åŸŸå‡å°‘å†…å­˜
```c
// åŸä»£ç ï¼šä½¿ç”¨å¤šä¸ªå­—èŠ‚
bit Num_Input;        // 1 bit
bit Point_Input;      // 1 bit
bit Flag_0;           // 1 bit
bit Flag_2;           // 1 bit
bit Data_Error;       // 1 bit

// ä¼˜åŒ–ï¼šä½¿ç”¨ä½åŸŸç»“æ„ï¼ˆå¦‚æœç¼–è¯‘å™¨ä¸æ”¯æŒbitç±»å‹ï¼‰
struct {
    unsigned char Num_Input   : 1;
    unsigned char Point_Input : 1;
    unsigned char Flag_0      : 1;
    unsigned char Flag_2      : 1;
    unsigned char Data_Error  : 1;
    unsigned char reserved    : 3;  // é¢„ç•™3ä½
} Flags;

// ä½¿ç”¨
Flags.Num_Input = 1;
if(Flags.Data_Error) { ... }
```

---

## æŠ€å·§3: ä¸‰å…ƒè¿ç®—ç¬¦

### 3.1 åŸºæœ¬ç”¨æ³•

#### âŒ å†—é•¿å†™æ³•
```c
if(Seg_Disp_Mode == 1)
    Seg_Disp_Mode = 2;
else
    Seg_Disp_Mode = 1;
```

#### âœ… ç®€æ´å†™æ³•
```c
Seg_Disp_Mode = (Seg_Disp_Mode == 1) ? 2 : 1;
```

---

### 3.2 èŒƒä¾‹ç¨‹åºä¸­çš„åº”ç”¨

```c
// èŒƒä¾‹ï¼šç•Œé¢åˆ‡æ¢
Seg_Disp_Mode = (Seg_Disp_Mode == 1) ? 2 : 1;

// ä½ çš„ä»£ç å¯ä»¥æ”¹ä¸º
if(Seg_Disp_Mode != 0)
    Seg_Disp_Mode = (Seg_Disp_Mode == 1) ? 2 : 1;
```

---

### 3.3 åµŒå¥—ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆé€‚åº¦ä½¿ç”¨ï¼‰

#### âœ… PWMç­‰çº§åˆ¤æ–­ä¼˜åŒ–
```c
// åŸä»£ç 
if(Temperature_Data > TMAX)
    Led_Level = 3;
else if(Temperature_Data >= TMIN)
    Led_Level = 6;
else
    Led_Level = 9;

// ç®€æ´å†™æ³•
Led_Level = (Temperature_Data > TMAX) ? 3 :
            (Temperature_Data >= TMIN) ? 6 : 9;
```

---

### 3.4 ä¸‰å…ƒè¿ç®—ç¬¦åœ¨æ•°ç»„é€‰æ‹©ä¸­çš„åº”ç”¨

```c
// é—ªçƒæ•ˆæœ
Seg_Buf[3 + Seg_Input_Index] = Seg_Star_Flag ? Seg_Input[Seg_Input_Index] : 10;

// ç­‰ä»·äº
if(Seg_Star_Flag)
    Seg_Buf[3 + Seg_Input_Index] = Seg_Input[Seg_Input_Index];
else
    Seg_Buf[3 + Seg_Input_Index] = 10;
```

---

## æŠ€å·§4: æ•°ç»„ç´¢å¼•è®¡ç®—æŠ€å·§

### 4.1 èŒƒä¾‹ç¨‹åºçš„å·§å¦™è®¾è®¡

#### âœ… å‚æ•°é—ªçƒçš„ç´¢å¼•è®¡ç®—
```c
// èŒƒä¾‹ç¨‹åº
bit Parameter_Index;  // 0æˆ–1

// æ˜¾ç¤ºå‚æ•°
Seg_Buf[2] = Parameter[0] / 10;  // ä¸Šé™åä½
Seg_Buf[3] = Parameter[0] % 10;  // ä¸Šé™ä¸ªä½
Seg_Buf[4] = Parameter[1] / 10;  // ä¸‹é™åä½
Seg_Buf[5] = Parameter[1] % 10;  // ä¸‹é™ä¸ªä½

// é—ªçƒæ•ˆæœï¼šé€šè¿‡Parameter_Indexè®¡ç®—åç§»
Seg_Buf[2 + 2*Parameter_Index] = Seg_Star_Flag ? Parameter[Parameter_Index]/10 : 10;
Seg_Buf[3 + 2*Parameter_Index] = Seg_Star_Flag ? Parameter[Parameter_Index]%10 : 10;
```

#### ğŸ” ç´¢å¼•è®¡ç®—è§£æ
```
Parameter_Index = 0 (ä¿®æ”¹ä¸Šé™)
  â†’ Seg_Buf[2 + 2*0] = Seg_Buf[2]  (ä¸Šé™åä½)
  â†’ Seg_Buf[3 + 2*0] = Seg_Buf[3]  (ä¸Šé™ä¸ªä½)

Parameter_Index = 1 (ä¿®æ”¹ä¸‹é™)
  â†’ Seg_Buf[2 + 2*1] = Seg_Buf[4]  (ä¸‹é™åä½)
  â†’ Seg_Buf[3 + 2*1] = Seg_Buf[5]  (ä¸‹é™ä¸ªä½)
```

---

#### âŒ ä½ çš„åŸä»£ç ï¼ˆå±•å¼€å†™æ³•ï¼‰
```c
unsigned char Temperature_Setting_Index;  // 0æˆ–2

if(Temperature_Setting_Index == 0)  // ä¿®æ”¹ä¸Šé™
{
    Seg_Buf[2] = 10;
    Seg_Buf[3] = 10;
}
if(Temperature_Setting_Index == 2)  // ä¿®æ”¹ä¸‹é™
{
    Seg_Buf[4] = 10;
    Seg_Buf[5] = 10;
}
```

---

#### âœ… ä¼˜åŒ–å»ºè®®ï¼ˆæ”¹ç”¨ç´¢å¼•è®¡ç®—ï¼‰
```c
// æ–¹æ¡ˆ1ï¼šæ”¹ç”¨0/1ç´¢å¼•
unsigned char Parameter_Index;  // 0æˆ–1

// é—ªçƒé€»è¾‘
if(Flag_2)
{
    Seg_Buf[2 + 2*Parameter_Index] = 10;
    Seg_Buf[3 + 2*Parameter_Index] = 10;
}

// æ–¹æ¡ˆ2ï¼šä¿æŒä½ çš„0/2ç´¢å¼•ï¼Œç”¨é™¤æ³•
if(Flag_2)
{
    Seg_Buf[2 + Temperature_Setting_Index] = 10;
    Seg_Buf[3 + Temperature_Setting_Index] = 10;
}
```

---

### 4.2 æ•°ç»„éå†ä¼˜åŒ–

#### âŒ å±•å¼€å†™æ³•
```c
Seg_Point[3] = 0;
Seg_Point[4] = 0;
Seg_Point[5] = 0;
```

#### âœ… å¾ªç¯å†™æ³•
```c
for(i = 3; i < 6; i++)
    Seg_Point[i] = 0;

// æˆ–ä½¿ç”¨memsetï¼ˆéœ€è¦string.hï¼‰
memset(&Seg_Point[3], 0, 3);
```

---

## æŠ€å·§5: å¾ªç¯ç®€åŒ–

### 5.1 Forå¾ªç¯ä¼˜åŒ–

#### âŒ ä½ çš„åŸä»£ç 
```c
for(j = 0; j < 3; j++)
{
    Temperature_Real[j] = 0;
}
for(i = 0; i < 3; i++)
{
    Temperature_Input_Point[i] = 0;
    Temperature_Input[i] = 13;
}
```

#### âœ… ç®€æ´å†™æ³•
```c
// åˆå¹¶å¾ªç¯
for(i = 0; i < 3; i++)
{
    Temperature_Real[i] = 0;
    Temperature_Input_Point[i] = 0;
    Temperature_Input[i] = 13;
}

// æˆ–ä½¿ç”¨memset
memset(Temperature_Real, 0, 3);
memset(Temperature_Input_Point, 0, 3);
memset(Temperature_Input, 13, 3);
```

---

### 5.2 Whileå¾ªç¯çš„å·§å¦™åº”ç”¨

#### âœ… èŒƒä¾‹ç¨‹åºï¼šå››èˆäº”å…¥å¤„ç†
```c
// æ ¹æ®å°æ•°ç‚¹ä½ç½®åŠ¨æ€é™¤æ³•
Temperature = Seg_Input[0]*100 + Seg_Input[1]*10 + Seg_Input[2] + 5;
while(3 - Point_Wela)
{
    Temperature /= 10.0;
    Point_Wela++;
}

// ç¤ºä¾‹ï¼šPoint_Wela=1ï¼ˆå°æ•°ç‚¹åœ¨ç¬¬2ä½ï¼‰
// å¾ªç¯æ¬¡æ•°ï¼š3-1=2æ¬¡
// 373.0 â†’ 37.3 â†’ 3.73ï¼ˆå®é™…åªé™¤2æ¬¡ï¼‰
```

---

### 5.3 å±•å¼€å°å¾ªç¯

```c
// å½“å¾ªç¯æ¬¡æ•°å›ºå®šä¸”å°‘æ—¶ï¼Œå±•å¼€å¯èƒ½æ›´å¿«
// âŒ å¾ªç¯å†™æ³•ï¼ˆ3æ¬¡è¿­ä»£ï¼‰
for(i = 0; i < 3; i++)
    Seg_Buf[3 + i] = Seg_Input[i];

// âœ… å±•å¼€å†™æ³•ï¼ˆæ¶ˆé™¤å¾ªç¯å¼€é”€ï¼‰
Seg_Buf[3] = Seg_Input[0];
Seg_Buf[4] = Seg_Input[1];
Seg_Buf[5] = Seg_Input[2];

// æ³¨æ„ï¼š51å•ç‰‡æœºä¸Šå±•å¼€é€šå¸¸æ›´å¿«
```

---

## æŠ€å·§6: æ¡ä»¶åˆ¤æ–­ç®€åŒ–

### 6.1 æå‰è¿”å›ï¼ˆEarly Returnï¼‰

#### âŒ æ·±å±‚åµŒå¥—
```c
void Key_Proc()
{
    if(Key_Slow_Down == 0)
    {
        Key_Slow_Down = 1;

        Key_Val = Key_Read();
        // ... å¤§é‡ä»£ç 
    }
}
```

#### âœ… æå‰è¿”å›
```c
void Key_Proc()
{
    if(Key_Slow_Down) return;  // æå‰é€€å‡º
    Key_Slow_Down = 1;

    Key_Val = Key_Read();
    // ... ä»£ç ä¸éœ€è¦ç¼©è¿›
}
```

**ä¼˜ç‚¹**ï¼šå‡å°‘ç¼©è¿›å±‚çº§ï¼Œæé«˜å¯è¯»æ€§

---

### 6.2 åˆå¹¶æ¡ä»¶

#### âŒ åˆ†æ•£åˆ¤æ–­
```c
if(Key_Down >= 1)
{
    if(Key_Down <= 10)
    {
        if(Seg_Input_Index <= 2)
        {
            // å¤„ç†
        }
    }
}
```

#### âœ… åˆå¹¶æ¡ä»¶
```c
if(Key_Down >= 1 && Key_Down <= 10 && Seg_Input_Index <= 2)
{
    // å¤„ç†
}
```

---

### 6.3 ä½¿ç”¨æŸ¥æ‰¾è¡¨æ›¿ä»£if-else

#### âŒ å¤§é‡if-else
```c
if(key == 1) return 0x01;
else if(key == 2) return 0x02;
else if(key == 3) return 0x04;
else if(key == 4) return 0x08;
// ...
```

#### âœ… æŸ¥æ‰¾è¡¨
```c
const unsigned char KeyMap[] = {0x01, 0x02, 0x04, 0x08, ...};
return KeyMap[key - 1];
```

---

## æŠ€å·§7: æ•°æ®ç»“æ„ä¼˜åŒ–

### 7.1 æ•°ç»„vsåˆ†æ•£å˜é‡

#### âŒ ä½ çš„åŸä»£ç 
```c
unsigned char Temperature_Setting[4] = {3,0,2,0};
unsigned char TMAX, TMIN;

// ä½¿ç”¨æ—¶éœ€è¦è½¬æ¢
TMAX = Temperature_Setting[0]*10 + Temperature_Setting[1];
TMIN = Temperature_Setting[2]*10 + Temperature_Setting[3];
```

#### âœ… èŒƒä¾‹ç¨‹åºï¼ˆç´§å‡‘ï¼‰
```c
unsigned char Parameter[2] = {30, 20};  // ç›´æ¥å­˜å‚¨å€¼

// æ˜¾ç¤ºæ—¶æ‰åˆ†è§£
Seg_Buf[2] = Parameter[0] / 10;
Seg_Buf[3] = Parameter[0] % 10;
```

**å¯¹æ¯”**ï¼š
- ä½ çš„ï¼š4å­—èŠ‚æ•°ç»„ + 2å­—èŠ‚å˜é‡ = 6å­—èŠ‚
- èŒƒä¾‹ï¼š2å­—èŠ‚æ•°ç»„ = 2å­—èŠ‚ï¼ˆèŠ‚çœ67%å†…å­˜ï¼‰

---

### 7.2 ç»“æ„ä½“å°è£…

#### âœ… ä½¿ç”¨ç»“æ„ä½“ç»„ç»‡ç›¸å…³æ•°æ®
```c
// æ¸©åº¦ç›¸å…³æ•°æ®å°è£…
typedef struct {
    unsigned char input[3];         // è¾“å…¥ç¼“å†²
    unsigned char input_point[3];   // å°æ•°ç‚¹æ ‡è®°
    unsigned char real[3];          // å®é™…æ¸©åº¦
    unsigned char data;             // å½“å‰æ¸©åº¦å€¼
    unsigned char index;            // è¾“å…¥ç´¢å¼•
    bit num_flag;                   // æ•°å­—è¾“å…¥æ ‡å¿—
    bit point_flag;                 // å°æ•°ç‚¹æ ‡å¿—
} Temperature_t;

Temperature_t Temp;

// ä½¿ç”¨
Temp.input[Temp.index] = Key_Down - 1;
Temp.index++;
```

**ä¼˜ç‚¹**ï¼š
- æ•°æ®ç»„ç»‡æ¸…æ™°
- ä¾¿äºå‚æ•°ä¼ é€’
- é¿å…å…¨å±€å˜é‡æ±¡æŸ“

---

### 7.3 æšä¸¾å®šä¹‰å¸¸é‡

#### âŒ é­”æ³•æ•°å­—
```c
if(Key_Down == 11) { ... }  // 11æ˜¯ä»€ä¹ˆï¼Ÿ
if(Key_Down == 12) { ... }  // 12æ˜¯ä»€ä¹ˆï¼Ÿ
```

#### âœ… æšä¸¾å®šä¹‰
```c
enum {
    KEY_NUM_0 = 1,
    KEY_NUM_1,
    // ...
    KEY_NUM_9 = 10,
    KEY_POINT = 11,
    KEY_MODE  = 12,
    KEY_PARAM = 13,
    KEY_ADD   = 14,
    KEY_SUB   = 15,
    KEY_CONFIRM = 16
};

if(Key_Down == KEY_POINT) { ... }
if(Key_Down == KEY_MODE) { ... }
```

---

## æŠ€å·§8: å®å®šä¹‰ä¸å¸¸é‡

### 8.1 å®å®šä¹‰å¸¸é‡

```c
// ç¡¬ä»¶å¼•è„šå®šä¹‰
#define LED_PORT    P1
#define SEG_PORT    P0
#define SEG_LATCH   P2_6
#define SEG_WELA    P2_7

// ç³»ç»Ÿå‚æ•°
#define TEMP_MAX    85
#define TEMP_MIN    0
#define PARAM_MAX   70
#define PARAM_MIN   10

// æ—¶é—´å¸¸é‡
#define KEY_SCAN_PERIOD    10   // ms
#define SEG_REFRESH_PERIOD 50   // ms
#define BLINK_PERIOD       250  // ms
#define LONG_PRESS_TIME    500  // ms
```

---

### 8.2 å‡½æ•°å®

```c
// æ•°å€¼é™åˆ¶å®
#define LIMIT(val, min, max) \
    ((val) < (min) ? (min) : ((val) > (max) ? (max) : (val)))

// ä½¿ç”¨
Temperature = LIMIT(Temperature, 0, 85);

// æ•°ç»„å…ƒç´ ä¸ªæ•°
#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))

// ä½æ“ä½œå®
#define SET_BIT(reg, bit)   ((reg) |= (1 << (bit)))
#define CLR_BIT(reg, bit)   ((reg) &= ~(1 << (bit)))
#define TOG_BIT(reg, bit)   ((reg) ^= (1 << (bit)))
#define GET_BIT(reg, bit)   (((reg) >> (bit)) & 1)
```

---

### 8.3 æ¡ä»¶ç¼–è¯‘

```c
// è°ƒè¯•å¼€å…³
#define DEBUG_MODE  1

#if DEBUG_MODE
    #define DEBUG_PRINT(x) printf(x)
#else
    #define DEBUG_PRINT(x)
#endif

// ä½¿ç”¨
DEBUG_PRINT("Temperature: %d\n");  // Releaseç‰ˆæœ¬è‡ªåŠ¨åˆ é™¤
```

---

## æŠ€å·§9: å‡½æ•°å°è£…ä¸å†…è”

### 9.1 æå–é‡å¤ä»£ç 

#### âŒ é‡å¤çš„æ¸…é™¤é€»è¾‘
```c
// ä½ çš„ä»£ç ä¸­å¤šå¤„å‡ºç°
Temperature_Input_Index = 0;
Num_Input = 0;
Point_Input = 0;
for(j = 0; j < 3; j++)
{
    Temperature_Real[j] = 0;
}
for(i = 0; i < 3; i++)
{
    Temperature_Input_Point[i] = 0;
    Temperature_Input[i] = 13;
}
```

#### âœ… å°è£…ä¸ºå‡½æ•°
```c
void Clear_Input_Data(void)
{
    unsigned char i;

    Temperature_Input_Index = 0;
    Num_Input = 0;
    Point_Input = 0;

    for(i = 0; i < 3; i++)
    {
        Temperature_Real[i] = 0;
        Temperature_Input_Point[i] = 0;
        Temperature_Input[i] = 13;
    }
}

// ä½¿ç”¨
if(invalid_data)
{
    Clear_Input_Data();
}
```

---

### 9.2 å†…è”å°å‡½æ•°

```c
// å°†é¢‘ç¹è°ƒç”¨çš„å°å‡½æ•°å£°æ˜ä¸ºå†…è”
#define INLINE static inline

INLINE unsigned char Is_Temp_Valid(unsigned char temp)
{
    return (temp >= TEMP_MIN && temp <= TEMP_MAX);
}

INLINE void Set_LED(unsigned char index, unsigned char state)
{
    ucLed[index] = state;
}

// ä½¿ç”¨
if(Is_Temp_Valid(Temperature_Data))
{
    Set_LED(0, 1);
}
```

---

## æŠ€å·§10: çŠ¶æ€æœºä¼˜åŒ–

### 10.1 ä½¿ç”¨switch-caseä¼˜åŒ–if-else

#### âŒ ä½ çš„åŸä»£ç ï¼ˆéƒ¨åˆ†ï¼‰
```c
if(Key_Down == 11) { ... }
if(Key_Down == 16) { ... }
if(Key_Down == 12) { ... }
if(Key_Down == 13) { ... }
if(Key_Down == 14) { ... }
if(Key_Down == 15) { ... }
```

#### âœ… ä½¿ç”¨switch-case
```c
switch(Key_Down)
{
    case KEY_POINT:    // 11
        // å¤„ç†å°æ•°ç‚¹
        break;

    case KEY_MODE:     // 12
        // æ¨¡å¼åˆ‡æ¢
        break;

    case KEY_PARAM:    // 13
        // å‚æ•°åˆ‡æ¢
        break;

    case KEY_ADD:      // 14
        // å‚æ•°åŠ 1
        break;

    case KEY_SUB:      // 15
        // å‚æ•°å‡1
        break;

    case KEY_CONFIRM:  // 16
        // ç¡®è®¤è¾“å…¥
        break;

    default:
        if(Key_Down >= 1 && Key_Down <= 10)
        {
            // æ•°å­—è¾“å…¥
        }
        break;
}
```

---

### 10.2 å‡½æ•°æŒ‡é’ˆè¡¨ï¼ˆé«˜çº§ï¼‰

```c
// å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹
typedef void (*KeyHandler)(void);

// æŒ‰é”®å¤„ç†å‡½æ•°
void Handle_Point(void) { /* ... */ }
void Handle_Mode(void)  { /* ... */ }
void Handle_Param(void) { /* ... */ }
void Handle_Add(void)   { /* ... */ }
void Handle_Sub(void)   { /* ... */ }
void Handle_Confirm(void) { /* ... */ }

// å‡½æ•°æŒ‡é’ˆè¡¨
const KeyHandler KeyHandlers[] =
{
    NULL,           // 0
    NULL,           // 1-10 (æ•°å­—è¾“å…¥)
    // ...
    NULL,           // 10
    Handle_Point,   // 11
    Handle_Mode,    // 12
    Handle_Param,   // 13
    Handle_Add,     // 14
    Handle_Sub,     // 15
    Handle_Confirm  // 16
};

// ä½¿ç”¨
if(Key_Down >= 1 && Key_Down <= 16 && KeyHandlers[Key_Down])
{
    KeyHandlers[Key_Down]();
}
```

---

## ğŸ¯ å®æˆ˜é‡æ„ï¼šä¼˜åŒ–ä½ çš„main.c

### é‡æ„ç›®æ ‡
å°†ä½ çš„451è¡Œä»£ç ä¼˜åŒ–åˆ°çº¦300è¡Œï¼ŒåŒæ—¶ä¿æŒå¯è¯»æ€§ã€‚

---

### é‡æ„1: Led_Procå‡½æ•°

#### åŸä»£ç ï¼ˆ34è¡Œï¼‰
```c
void Led_Proc()
{
    if(Temperature_Data > TMAX)
    {
        Led_Level = 3;
        ucLed[0] = 1;
    }
    else
    {
        ucLed[0] = 0;
    }

    if((Temperature_Data >= TMIN) && (Temperature_Data <= TMAX))
    {
        Led_Level = 6;
        ucLed[1] = 1;
    }
    else
    {
        ucLed[1] = 0;
    }

    if(Temperature_Data < TMIN)
    {
        Led_Level = 9;
        ucLed[2] = 1;
    }
    else
    {
        ucLed[2] = 0;
    }

    if(Data_Error == 1)
    {
        ucLed[3] = 1;
    }
    else
    {
        ucLed[3] = 0;
    }
}
```

---

#### ä¼˜åŒ–åï¼ˆ8è¡Œï¼Œå‡å°‘76%ï¼‰
```c
void Led_Proc()
{
    // ç›´æ¥èµ‹å€¼å¸ƒå°”è¡¨è¾¾å¼
    ucLed[0] = (Temperature_Data > TMAX);
    ucLed[1] = (Temperature_Data >= TMIN) && (Temperature_Data <= TMAX);
    ucLed[2] = (Temperature_Data < TMIN);
    ucLed[3] = Data_Error;

    // PWMç­‰çº§ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰
    Led_Level = (Temperature_Data > TMAX) ? 3 :
                (Temperature_Data >= TMIN) ? 6 : 9;
}
```

---

### é‡æ„2: è¾“å…¥æ•°æ®æ¸…é™¤

#### åŸä»£ç ï¼ˆé‡å¤3æ¬¡ï¼Œæ¯æ¬¡14è¡Œï¼‰
```c
Temperature_Input_Index = 0;
Num_Input = 0;
Point_Input = 0;
for(j = 0; j < 3; j++)
{
    Temperature_Real[j] = 0;
}
for(i = 0; i < 3; i++)
{
    Temperature_Input_Point[i] = 0;
    Temperature_Input[i] = 13;
}
```

---

#### ä¼˜åŒ–åï¼ˆå°è£…ä¸ºå‡½æ•°ï¼‰
```c
void Clear_Input(void)
{
    unsigned char i;

    Temperature_Input_Index = 0;
    Num_Input = 0;
    Point_Input = 0;

    memset(Temperature_Real, 0, 3);
    memset(Temperature_Input_Point, 0, 3);
    memset(Temperature_Input, 13, 3);
}

// ä½¿ç”¨ï¼ˆæ›¿æ¢3æ¬¡é‡å¤ä»£ç ï¼‰
Clear_Input();
```

**èŠ‚çœ**ï¼š42è¡Œ â†’ 13è¡Œï¼ˆå‡å°‘69%ï¼‰

---

### é‡æ„3: å‚æ•°è°ƒæ•´é€»è¾‘

#### åŸä»£ç ï¼ˆæŒ‰é”®14ï¼Œ35è¡Œï¼‰
```c
if(Key_Down == 14)
{
    if(Seg_Dis_Mode == 2)
    {
        Temperature_Setting[Temperature_Setting_Index + 1]++;
        if(Temperature_Setting[Temperature_Setting_Index + 1] == 10)
        {
            Temperature_Setting[Temperature_Setting_Index + 1] = 0;
            Temperature_Setting[Temperature_Setting_Index]++;
        }
        if((Temperature_Setting[Temperature_Setting_Index] == 7) &&
           (Temperature_Setting[Temperature_Setting_Index + 1] == 1))
        {
            Temperature_Setting[Temperature_Setting_Index] = 7;
            Temperature_Setting[Temperature_Setting_Index + 1] = 0;
        }
    }
}

if(Key_Old == 14)
{
    if(Seg_Dis_Mode == 2)
    {
        if(Key_Long0 >= 500)
        {
            // é‡å¤ä¸Šé¢çš„é€»è¾‘...
        }
    }
}
```

---

#### ä¼˜åŒ–åï¼ˆæå–å…¬å…±å‡½æ•°ï¼‰
```c
void Adjust_Parameter(unsigned char delta)
{
    unsigned char* param = &Temperature_Setting[Temperature_Setting_Index];
    unsigned char val = param[0] * 10 + param[1];

    val += delta;
    val = LIMIT(val, PARAM_MIN, PARAM_MAX);  // é™åˆ¶10-70

    param[0] = val / 10;
    param[1] = val % 10;
}

// æŒ‰é”®å¤„ç†
if(Key_Down == 14 || (Key_Old == 14 && Key_Long0 >= 500))
{
    if(Seg_Dis_Mode == 2)
        Adjust_Parameter(1);  // +1
}

if(Key_Down == 15 || (Key_Old == 15 && Key_Long1 >= 500))
{
    if(Seg_Dis_Mode == 2)
        Adjust_Parameter(-1);  // -1
}
```

**èŠ‚çœ**ï¼š70è¡Œ â†’ 25è¡Œï¼ˆå‡å°‘64%ï¼‰

---

### é‡æ„4: é—ªçƒé€»è¾‘ä¼˜åŒ–

#### åŸä»£ç 
```c
if(Flag_2)
{
    if(Temperature_Setting_Index == 0)
    {
        Seg_Buf[2] = 10;
        Seg_Buf[3] = 10;
    }
    if(Temperature_Setting_Index == 2)
    {
        Seg_Buf[4] = 10;
        Seg_Buf[5] = 10;
    }
}
```

---

#### ä¼˜åŒ–åï¼ˆæ•°ç»„ç´¢å¼•è®¡ç®—ï¼‰
```c
// æ”¹ç”¨0/1ç´¢å¼•
unsigned char Parameter_Index;  // 0æˆ–1ï¼Œä¸å†æ˜¯0/2

// æŒ‰é”®13åˆ‡æ¢
Parameter_Index ^= 1;  // 0â†”1åˆ‡æ¢

// é—ªçƒé€»è¾‘
if(Flag_2)
{
    Seg_Buf[2 + 2*Parameter_Index] = 10;
    Seg_Buf[3 + 2*Parameter_Index] = 10;
}
```

**èŠ‚çœ**ï¼š12è¡Œ â†’ 4è¡Œï¼ˆå‡å°‘67%ï¼‰

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœæ€»ç»“

| å‡½æ•°/æ¨¡å— | åŸä»£ç è¡Œæ•° | ä¼˜åŒ–åè¡Œæ•° | å‡å°‘æ¯”ä¾‹ |
|----------|-----------|-----------|---------|
| Led_Proc | 34è¡Œ | 8è¡Œ | 76% â†“ |
| Clear_Input | 42è¡Œ(é‡å¤3æ¬¡) | 13è¡Œ | 69% â†“ |
| å‚æ•°è°ƒæ•´ | 70è¡Œ | 25è¡Œ | 64% â†“ |
| é—ªçƒé€»è¾‘ | 12è¡Œ | 4è¡Œ | 67% â†“ |
| **æ€»è®¡** | **158è¡Œ** | **50è¡Œ** | **68% â†“** |

**é¢„è®¡æ€»ä¼˜åŒ–**ï¼š451è¡Œ â†’ çº¦300è¡Œï¼ˆå‡å°‘33%ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¯è¯»æ€§ä¼˜å…ˆåŸåˆ™
```c
// âŒ è¿‡åº¦ä¼˜åŒ–ï¼Œéš¾ä»¥ç†è§£
x = (a & b) | (~a & c);

// âœ… æ¸…æ™°è¡¨è¾¾
if(a)
    x = b;
else
    x = c;
```

---

### 2. é¿å…è¿‡åº¦ä½¿ç”¨å®
```c
// âŒ å±é™©çš„å®
#define SQUARE(x) x * x
SQUARE(a + b);  // å±•å¼€ä¸º a + b * a + bï¼ˆé”™è¯¯ï¼ï¼‰

// âœ… å®‰å…¨çš„å®
#define SQUARE(x) ((x) * (x))
SQUARE(a + b);  // å±•å¼€ä¸º ((a + b) * (a + b))

// âœ… æ›´å¥½ï¼šä½¿ç”¨å†…è”å‡½æ•°
INLINE unsigned int Square(unsigned int x)
{
    return x * x;
}
```

---

### 3. æ€§èƒ½vså¯è¯»æ€§æƒè¡¡
```c
// é«˜å¯è¯»æ€§ï¼ˆæ¨èï¼‰
ucLed[0] = (Temperature_Data > TMAX);

// é«˜æ€§èƒ½ä½†æ™¦æ¶©ï¼ˆä»…åœ¨å…³é”®è·¯å¾„ä½¿ç”¨ï¼‰
ucLed[0] = Temperature_Data / (TMAX + 1);
```

---

### 4. å›¢é˜Ÿåä½œè€ƒè™‘
- ç®€æ´ä»£ç éœ€è¦å›¢é˜Ÿç»Ÿä¸€é£æ ¼
- æ³¨é‡Šè¯´æ˜å¤æ‚æŠ€å·§
- ä»£ç å®¡æŸ¥æ—¶éªŒè¯å¯è¯»æ€§

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### åˆçº§ï¼ˆç«‹å³å¯ç”¨ï¼‰
1. âœ… å¸ƒå°”è¡¨è¾¾å¼èµ‹å€¼
2. âœ… ä¸‰å…ƒè¿ç®—ç¬¦
3. âœ… æå‰è¿”å›
4. âœ… å®å®šä¹‰å¸¸é‡

### ä¸­çº§ï¼ˆç†è§£åä½¿ç”¨ï¼‰
1. âœ… ä½è¿ç®—ä¼˜åŒ–
2. âœ… æ•°ç»„ç´¢å¼•è®¡ç®—
3. âœ… å‡½æ•°å°è£…
4. âœ… æŸ¥æ‰¾è¡¨

### é«˜çº§ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
1. âš ï¸ å¤æ‚ä½è¿ç®—è¡¨è¾¾å¼
2. âš ï¸ å‡½æ•°æŒ‡é’ˆè¡¨
3. âš ï¸ åµŒå¥—ä¸‰å…ƒè¿ç®—ç¬¦
4. âš ï¸ å®å‡½æ•°

---

## ğŸ“š æ¨èå®è·µ

### ç¬¬1æ­¥ï¼šä¼˜åŒ–ä½ çš„Led_Proc
```c
// ç«‹å³æ”¹è¿›ï¼Œå‡å°‘76%ä»£ç 
void Led_Proc()
{
    ucLed[0] = (Temperature_Data > TMAX);
    ucLed[1] = (Temperature_Data >= TMIN) && (Temperature_Data <= TMAX);
    ucLed[2] = (Temperature_Data < TMIN);
    ucLed[3] = Data_Error;

    Led_Level = (Temperature_Data > TMAX) ? 3 :
                (Temperature_Data >= TMIN) ? 6 : 9;
}
```

### ç¬¬2æ­¥ï¼šå°è£…Clear_Inputå‡½æ•°
```c
void Clear_Input(void)
{
    unsigned char i;
    Temperature_Input_Index = 0;
    Num_Input = 0;
    Point_Input = 0;

    for(i = 0; i < 3; i++)
    {
        Temperature_Real[i] = 0;
        Temperature_Input_Point[i] = 0;
        Temperature_Input[i] = 13;
    }
}
```

### ç¬¬3æ­¥ï¼šæ·»åŠ å®å®šä¹‰
```c
#define TEMP_MAX    85
#define TEMP_MIN    0
#define PARAM_MAX   70
#define PARAM_MIN   10

#define KEY_POINT   11
#define KEY_MODE    12
#define KEY_PARAM   13
#define KEY_ADD     14
#define KEY_SUB     15
#define KEY_CONFIRM 16
```

---

## ğŸ¯ æ€»ç»“

### ä»£ç ç®€æ´æ€§çš„é»„é‡‘æ³•åˆ™

1. **æ¶ˆé™¤é‡å¤**ï¼šæå–å…¬å…±ä»£ç ä¸ºå‡½æ•°
2. **ç›´æ¥è¡¨è¾¾**ï¼šå¸ƒå°”å€¼ç›´æ¥èµ‹å€¼ï¼Œä¸ç”¨if-else
3. **åˆ©ç”¨è¿ç®—ç¬¦**ï¼šä¸‰å…ƒè¿ç®—ç¬¦ã€ä½è¿ç®—
4. **ä¼˜åŒ–ç»“æ„**ï¼šæ•°ç»„ç´¢å¼•è®¡ç®—æ›¿ä»£æ¡ä»¶åˆ¤æ–­
5. **å®å®šä¹‰å¸¸é‡**ï¼šæ¶ˆé™¤é­”æ³•æ•°å­—
6. **æå‰è¿”å›**ï¼šå‡å°‘åµŒå¥—å±‚çº§
7. **å¹³è¡¡æƒè¡¡**ï¼šç®€æ´ä½†ä¸å¤±å¯è¯»æ€§

---

### å®æˆ˜æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦æœ‰é‡å¤ä»£ç å¯ä»¥æå–ä¸ºå‡½æ•°ï¼Ÿ
- [ ] if-elseèµ‹å€¼0/1èƒ½å¦æ”¹ä¸ºå¸ƒå°”è¡¨è¾¾å¼ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†é­”æ³•æ•°å­—ï¼Ÿ
- [ ] æ¡ä»¶åˆ¤æ–­èƒ½å¦ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Ÿ
- [ ] å¤šä¸ªifèƒ½å¦æ”¹ä¸ºswitch-caseï¼Ÿ
- [ ] å¾ªç¯æ˜¯å¦å¯ä»¥åˆå¹¶ï¼Ÿ
- [ ] æ•°ç»„æ“ä½œèƒ½å¦ç”¨memsetï¼Ÿ
- [ ] å˜é‡å‘½åæ˜¯å¦è¯­ä¹‰åŒ–ï¼Ÿ

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2026-01-31
**é€‚ç”¨åœºæ™¯**ï¼š51å•ç‰‡æœºåµŒå…¥å¼Cç¼–ç¨‹
**éš¾åº¦ç­‰çº§**ï¼šåˆçº§ â†’ é«˜çº§
**é¢„æœŸæ•ˆæœ**ï¼šä»£ç å‡å°‘30-50%ï¼Œå¯è¯»æ€§ä¿æŒæˆ–æå‡
