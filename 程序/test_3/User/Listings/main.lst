C51 COMPILER V9.59.0.0   MAIN                                                              06/20/2025 20:56:06 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keilc51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*头文件声明区*/
   2          #include <REGX52.H>
   3          #include "Key.h"
   4          #include "Seg.h"
   5          
   6          /*变量声明区*/
   7          unsigned char Key_Slow_Down;//10ms
   8          unsigned int Seg_Slow_Down;//500ms
   9          unsigned char Key_Val,Key_Down,Key_Up,Key_Old;
  10          unsigned char Seg_Pos;
  11          unsigned char Seg_Buf[6]={10,10,10,10,10,10};
  12          unsigned char Seg_Mode;//0-显示 1-设置
  13          unsigned int Timer_1000ms;
  14          unsigned char Timer_Count=30;
  15          bit System_Flag;//系统标志位 0-暂停 1-开始
  16          unsigned char Set_Dat[3] = {15,30,60};
  17          unsigned char Set_Dat_Index=1;
  18          unsigned int Timer_500ms;
  19          bit Seg_Flag;
  20          /*按键处理函数*/
  21          void Key_Proc()
  22          {
  23   1        if(Key_Slow_Down) return;
  24   1        Key_Slow_Down=1;
  25   1        
  26   1        Key_Val=Key_Read();
  27   1        Key_Down=Key_Val&(Key_Val^Key_Old);
  28   1        Key_Up=~Key_Val&(Key_Val^Key_Old);
  29   1        Key_Old=Key_Val;
  30   1        
  31   1        switch(Key_Down)
  32   1        {
  33   2          case 1:
  34   2            if (Seg_Mode==0) System_Flag =1;
  35   2            break;
  36   2          case 2:
  37   2            Timer_Count = Set_Dat[Set_Dat_Index];
  38   2            break;
  39   2          case 3:
  40   2            if(Seg_Mode==1) Timer_Count = Set_Dat[Set_Dat_Index];
  41   2            Seg_Mode ^=1;
  42   2            break;
  43   2          case 4:
  44   2            if(Seg_Mode==1)
  45   2            {
  46   3            if(++Set_Dat_Index==3) Set_Dat_Index=0;
  47   3            }
  48   2            break;
  49   2        }
  50   1          
  51   1        
  52   1        
  53   1        
  54   1      }
C51 COMPILER V9.59.0.0   MAIN                                                              06/20/2025 20:56:06 PAGE 2   

  55          
  56          /*信息处理函数*/
  57          void Seg_Proc()
  58          {
  59   1        if(Seg_Slow_Down) return;
  60   1        Key_Slow_Down=1;
  61   1        Seg_Buf[0]=Seg_Mode+1;
  62   1        if(Seg_Mode==0)
  63   1        {
  64   2          Seg_Buf[4]=Timer_Count /10 % 10;
  65   2          Seg_Buf[5]=Timer_Count % 10;
  66   2        }
  67   1        else
  68   1        {
  69   2          if(Seg_Flag ==1)
  70   2          {
  71   3            
  72   3          Seg_Buf[4]=Set_Dat[Set_Dat_Index] / 10 % 10;
  73   3          Seg_Buf[5]=Set_Dat[Set_Dat_Index] % 10;
  74   3          }
  75   2          else
  76   2          {
  77   3            Seg_Buf[4]=10;
  78   3            Seg_Buf[5]=10;
  79   3          }
  80   2        }
  81   1      }
  82          
  83           /*其他显示函数*/
  84          void Led_Proc()
  85          {
  86   1        if(Timer_Count ==0)
  87   1        {
  88   2          P1=0x00;
  89   2          P2_3=0;
  90   2        }
  91   1        else
  92   1        {
  93   2          P1=0xff;
  94   2          P2_3=1;
  95   2        }
  96   1      }
  97          
  98          
  99          /*定时器0初始化函数*/
 100          void Timer0Init(void)   //1毫秒@12.000MHz
 101          {
 102   1        TMOD &= 0xF0;   //设置定时器模式
 103   1        TMOD |= 0x01;   //设置定时器模式
 104   1        TL0 = 0x18;   //设置定时初始值
 105   1        TH0 = 0xFC;   //设置定时初始值
 106   1        TF0 = 0;    //清除TF0标志
 107   1        TR0 = 1;    //定时器0开始计时
 108   1        ET0=1;
 109   1        EA=1;
 110   1      }
 111          
 112          /*定时器0中段服务函数*/
 113          void Timer0Server() interrupt 1
 114          {
 115   1        TL0 = 0x18;   //设置定时初始值
 116   1        TH0 = 0xFC;   //设置定时初始值
C51 COMPILER V9.59.0.0   MAIN                                                              06/20/2025 20:56:06 PAGE 3   

 117   1        if(++Key_Slow_Down==10) Key_Slow_Down=0;
 118   1        if (++Seg_Slow_Down==500) Seg_Slow_Down=0;
 119   1        if(++Seg_Pos==6) Seg_Pos=0;
 120   1        Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos]);
 121   1        if(System_Flag ==1)
 122   1        {
 123   2        if(++Timer_1000ms==1000)
 124   2        {
 125   3          Timer_1000ms=0;
 126   3          Timer_Count--;
 127   3          if(Timer_Count==255) Timer_Count = 0;
 128   3        }
 129   2        
 130   2        }
 131   1        if(++Timer_500ms==500)
 132   1        {
 133   2          Timer_500ms=0;
 134   2          Seg_Flag ^=1; 
 135   2        }
 136   1      }
 137          
 138          /*Main*/
 139          void main()
 140          {
 141   1        Timer0Init();
 142   1        while(1)
 143   1        {
 144   2          Key_Proc();
 145   2          Seg_Proc();
 146   2          Led_Proc();
 147   2        }
 148   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    401    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
